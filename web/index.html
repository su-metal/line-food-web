<!DOCTYPE html>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, viewport-fit=cover"
/>
<title>line-food-web</title>
<!-- favicon -->
<link rel="icon" href="./favicon.svg" type="image/svg+xml" />
<link rel="stylesheet" href="./css/app.css?v=20250910a" />
<!-- æ—§: v=20250907 ã‚’ä½¿ã£ã¦ã„ã‚‹è¡Œã‚’å‰Šé™¤ -->

<!-- ãƒ˜ãƒƒãƒ€ -->
<header class="app-header">
  <div class="search-wrap">
    <svg aria-hidden="true" viewBox="0 0 24 24">
      <path
        d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
      />
    </svg>
    <input type="search" placeholder="ç¾åœ¨åœ°ãƒ»é§…ãƒ»åº—èˆ—åãªã©ã‹ã‚‰æ¢ã™" />
  </div>
  <button class="icon-btn" aria-label="é€šçŸ¥">
    <svg viewBox="0 0 24 24">
      <path d="M10 21a2 2 0 0 0 4 0M5 8a7 7 0 1 1 14 0v5l2 3H3l2-3V8Z" />
    </svg>
  </button>
</header>

<!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ -->
<!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã‚¢ã‚¤ã‚³ãƒ³å·®ã—æ›¿ãˆç‰ˆï¼‰ -->
<div class="cat-row" id="category-row">
  <button type="button" class="cat-item" data-cat="ãƒ‘ãƒ³">
    <img
      src="./img/categories/bread.png"
      alt="ãƒ‘ãƒ³"
      width="48"
      height="48"
      loading="lazy"
    />
    <span>ãƒ‘ãƒ³</span>
  </button>

  <button type="button" class="cat-item" data-cat="ã‚±ãƒ¼ã‚­">
    <img
      src="./img/categories/cake.png"
      alt="ã‚±ãƒ¼ã‚­"
      width="48"
      height="48"
      loading="lazy"
    />
    <span>ã‚±ãƒ¼ã‚­</span>
  </button>

  <button type="button" class="cat-item" data-cat="ãŠæƒ£èœ">
    <img
      src="./img/categories/deli.png"
      alt="ãŠæƒ£èœ"
      width="48"
      height="48"
      loading="lazy"
    />
    <span>ãŠæƒ£èœ</span>
  </button>

  <button type="button" class="cat-item" data-cat="ãŠå¼å½“">
    <img
      src="./img/categories/bento.png"
      alt="ãŠå¼å½“"
      width="48"
      height="48"
      loading="lazy"
    />
    <span>ãŠå¼å½“</span>
  </button>

  <button type="button" class="cat-item" data-cat="ãã®ä»–">
    <img
      src="./img/categories/others.png"
      alt="ãã®ä»–"
      width="48"
      height="48"
      loading="lazy"
    />
    <span>ãã®ä»–</span>
  </button>
</div>

<!-- ä¾¡æ ¼å¸¯ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚¿ã‚°ï¼‰ -->
<section class="price">
  <div class="chip-row" role="group" aria-label="ä¾¡æ ¼å¸¯ã‹ã‚‰é¸ã¶">
    <button class="chip" data-price="<=300" aria-pressed="false">
      300å††ä»¥ä¸‹
    </button>
    <button class="chip" data-price="<=500" aria-pressed="false">
      500å††ä»¥ä¸‹
    </button>
    <button class="chip" data-price="<=1000" aria-pressed="false">
      1000å††ä»¥ä¸‹
    </button>
    <button class="chip" data-price="<=1500" aria-pressed="false">
      1500å††ä»¥ä¸‹
    </button>
  </div>
</section>

<!-- â–¼ ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆï¼ˆè¿‘ã„ï½œå®‰ã„ï¼‰ -->

<main class="container">
  <!-- ===== Spotlight Hero (new) ===== -->
 <!-- ===== Spotlight (Agoda-like) ===== -->
<section class="hero-spotlight">
  <div class="spotlight-head">
    <h2>ã„ã¾è¡Œã‘ã‚‹ãŠã™ã™ã‚</h2>
    <a class="spotlight-more" href="./shops.html">ã‚‚ã£ã¨è¦‹ã‚‹</a>
  </div>

  <article class="spotlight-card" id="spotlight">
    <a class="spotlight-media" id="sp-link" href="#">
      <img id="sp-img" src="./img/hero1.jpg" alt="" />
      <span class="sp-count" id="sp-count">1/5</span>

      <div class="sp-acts">
        <!-- å…±æœ‰ -->
        <button class="sp-act" aria-label="å…±æœ‰">
          <svg viewBox="0 0 24 24"><path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7M16 6l-4-4-4 4M12 2v14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <!-- ãŠæ°—ã«å…¥ã‚Š -->
        <button class="sp-act" aria-label="ãŠæ°—ã«å…¥ã‚Š">
          <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <!-- å³ä¸‹ï¼šèµ¤ãƒªãƒœãƒ³ï¼‹ä¾¡æ ¼ã‚«ãƒ¼ãƒ‰ -->
      <div class="sp-price">
        <span class="sp-ribbon" id="sp-ribbon">å½“æ—¥æ®‹ã‚Š2ã‚»ãƒƒãƒˆã®ã¿</span>
        <div class="sp-price-card">
          <span class="yen">Â¥</span><span id="sp-price">1,280</span>
          <small id="sp-price-sub">ç¨è¾¼</small>
        </div>
      </div>

      <!-- ä¸‹å´ã®é»’ã‚°ãƒ©ãƒ‡ï¼ˆå¯èª­æ€§ï¼‰ -->
      <div class="sp-grad"></div>
    </a>

    <div class="spotlight-info">
      <div class="eyebrow">ã‚¤ãƒæŠ¼ã—</div>
      <h3 class="title" id="sp-title">ãƒ™ãƒ¼ã‚«ãƒªãƒ¼ ã¨ã‚ˆã¯ã—</h3>
      <div class="meta" id="sp-meta">
        <!-- ä¾‹ï¼šğŸš¶ è±Šæ©‹é§…ã‹ã‚‰å¾’æ­©5åˆ† ãƒ» ğŸ•’ 7:30â€“9:30 -->
      </div>
    </div>
  </article>
</section>
<!-- ===== /Spotlight ===== -->

  <!-- ===== /Spotlight Hero ===== -->

  <div class="quick">
    <div class="seg-row" role="tablist" aria-label="ä¸¦ã³æ›¿ãˆ">
      <button
        type="button"
        class="seg-btn is-active"
        data-sort="near"
        aria-selected="true"
      >
        è·é›¢é †
      </button>
      <button
        type="button"
        class="seg-btn"
        data-sort="cheap"
        aria-selected="false"
      >
        ä¾¡æ ¼é †
      </button>
      <button
        type="button"
        class="seg-btn"
        data-sort="urgent"
        aria-selected="false"
      >
        çµ‚äº†é–“è¿‘</button
      ><!-- â˜…è¿½åŠ  -->
    </div>
  </div>

  <!-- è¿‘ãã®ãŠåº— -->
  <div class="section-head">
    <h3>ç¾åœ¨åœ°ä»˜è¿‘ã®ãŠåº—</h3>
    <a class="more" href="#">ã‚‚ã£ã¨è¦‹ã‚‹</a>
  </div>

  <!-- ç¾åœ¨åœ°ä»˜è¿‘ã®ãŠåº— -->
  <div class="card-row" id="nearby-row"></div>

  <!-- æœ€è¿‘è¿½åŠ  -->
  <div class="section-head">
    <h3>æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸãŠåº—</h3>
    <a class="more" href="#">ã‚‚ã£ã¨è¦‹ã‚‹</a>
  </div>

  <div class="card-row" id="recent-row"></div>

  <!-- åº—èˆ—ã‚«ãƒ¼ãƒ‰ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼šcompactï¼ˆbodyã‚’ã‚µãƒ ãƒå†…ã«é‡ã­ã‚‹ï¼‰ -->
  <template id="shop-card-template">
    <!-- v3: ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ»ãƒ˜ãƒƒãƒ€/æœ¬æ–‡ã®2æ®µæ§‹æˆã€‚ã‚µãƒ ãƒã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯å»ƒæ­¢ -->
    <article class="shop-card card-v3" data-shop-id="">
      <!-- ãƒ˜ãƒƒãƒ€ï¼šåº—åï¼‹ã‚«ãƒ†ã‚´ãƒª/è·é›¢/ä½æ‰€ï¼‹ãŠæ°—ã«å…¥ã‚Š -->
      <header class="card-head">
        <div class="store">
          <div class="avatar" aria-hidden="true">S</div>
          <div class="store-meta">
            <h4 class="store-name">åº—èˆ—å</h4>
            <div class="store-sub">
              <span class="chip point">ã‚«ãƒ†ã‚´ãƒª</span>
              <span class="chip status">1.2 km</span>
              <span class="chip place">ä½æ‰€ãªã©</span>
            </div>
          </div>
        </div>
        <button class="heart fav-btn" ...>
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <!-- lucideæº–æ‹ ã®ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„ãƒãƒ¼ãƒˆ -->
            <path
              d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"
            />
          </svg>
        </button>
      </header>

      <!-- æœ¬æ–‡ï¼šä»£è¡¨ã‚»ãƒƒãƒˆ1ä»¶ï¼ˆå¿…è¦ãªã‚‰2ä»¶ç›®ä»¥é™ã¯ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦æŒ¿å…¥ï¼‰ -->
      <div class="card-body"></div>

      <!-- 3ä»¶ä»¥ä¸Šã®ã¨ãã« JS ã§ hidden ã‚’å¤–ã—ã€æ•°å­—ã‚’æ›¸ãæ›ãˆ -->
      <div class="more-wrap" hidden>
        <button class="more-bundles">ä»– <span class="n">1</span> ã‚»ãƒƒãƒˆ</button>
      </div>
    </article>
  </template>
</main>

<!-- å›ºå®šCTAï¼šã‚¿ãƒ–ãƒãƒ¼ã®ç›´ä¸Šã«å›ºå®šè¡¨ç¤º -->
<div id="home-cta" class="home-cta" role="complementary">
  <button type="button" class="home-cta-btn">START AN ORDER</button>
</div>

<!-- ä¸‹éƒ¨ã‚¿ãƒ– -->
<nav class="tabbar" aria-label="ãƒ¡ã‚¤ãƒ³">
  <a class="active" href="#">
    <span class="icon" aria-hidden="true">
      <!-- home/store -->
      <svg viewBox="0 0 24 24">
        <path
          d="M4 10v10h16V10M2 11l10-7 10 7"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </span>
    <span class="label">ãƒ›ãƒ¼ãƒ </span>
  </a>
  <a href="#">
    <span class="icon" aria-hidden="true">
      <!-- search -->
      <svg viewBox="0 0 24 24">
        <circle
          cx="11"
          cy="11"
          r="6"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        />
        <path
          d="M20 20l-3.8-3.8"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
        />
      </svg>
    </span>
    <span class="label">ãŠåº—ã‚’æ¢ã™</span>
  </a>
  <a href="#">
    <span class="icon" aria-hidden="true">
      <!-- heart -->
      <svg viewBox="0 0 24 24">
        <path
          d="M12 21s-6.7-4.2-9.2-8C1.2 10 2.1 7.2 4.6 6c1.9-1 4.3-.5 5.6 1.2C11.5 5.5 13.9 5 15.8 6c2.5 1.2 3.4 4 1.8 7-2.5 3.8-9.6 8-9.6 8Z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        />
      </svg>
    </span>
    <span class="label">ãŠæ°—ã«å…¥ã‚Š</span>
  </a>
  <a href="#">
    <span class="icon" aria-hidden="true">
      <!-- lifebuoy -->
      <svg viewBox="0 0 24 24">
        <circle
          cx="12"
          cy="12"
          r="9"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        />
        <circle
          cx="12"
          cy="12"
          r="4"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        />
        <path
          d="M5.6 5.6l2.2 2.2M16.2 5.6l2.2 2.2M5.6 16.2l2.2 2.2M16.2 16.2l2.2 2.2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
        />
      </svg>
    </span>
    <span class="label">ãƒ¬ã‚¹ã‚­ãƒ¥ãƒ¼</span>
  </a>
  <a href="#">
    <span class="icon" aria-hidden="true">
      <!-- user -->
      <svg viewBox="0 0 24 24">
        <circle
          cx="12"
          cy="8"
          r="3.2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        />
        <path
          d="M5 19a7 7 0 0 1 14 0"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
        />
      </svg>
    </span>
    <span class="label">ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
  </a>
</nav>

<script type="module">
  const cta = document.getElementById("home-cta");
  if (cta && "ResizeObserver" in window) {
    const ro = new ResizeObserver(([entry]) => {
      document.documentElement.style.setProperty(
        "--home-cta-h",
        `${entry.contentRect.height}px`
      );
    });
    ro.observe(cta);
  }
</script>

<!-- ï¼ˆãƒ‡ãƒãƒƒã‚°è¦ç´ ï¼šæ—¢å­˜ app.js ãŒå‚ç…§ã™ã‚‹ã®ã§éè¡¨ç¤ºã§æ®‹ã™ï¼‰ -->
<button id="btnWho" hidden>/api/whoami ã‚’å‘¼ã¶</button>
<pre id="out" hidden></pre>

<!-- LIFF SDK & æ—¢å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script type="module" src="./js/app.js"></script>
<script type="module">
  // â–¼ fav.js ã‚’èª­ã¿è¾¼ã¿ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç ´ã‚Šä»˜ãï¼‰ã€LIFFæº–å‚™å¾Œã«åˆæœŸåŒ–
  const bust = "v20250909c";
  try {
    const m = await import(`./js/fav.js?${bust}`).catch(() => ({}));
    if (m.initAllFavButtons) await liff.ready.then(() => m.initAllFavButtons());
  } catch {}

  // â–¼ï¼ˆæ®‹ã—ã¦ã„ã¦ã‚‚ç„¡å®³ï¼‰ãƒãƒŠãƒ¼Ã—
  document
    .querySelector(".banner-close")
    ?.addEventListener("click", () =>
      document.querySelector(".banner")?.remove()
    );

  // â–¼ ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼šã‚¤ãƒ™ãƒ³ãƒˆå§”è­² + ARIA å¯¾å¿œï¼ˆis-active ã¨ aria-pressed ã‚’åŒæœŸï¼‰
  const strip = document.querySelector(".cat-strip");
  if (strip) {
    // åˆæœŸé¸æŠï¼ˆ?category= ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Œã°åæ˜ ï¼‰
    const init = new URLSearchParams(location.search).get("category");

    const activate = (btn) => {
      strip.querySelectorAll(".cat-item.is-active").forEach((b) => {
        b.classList.remove("is-active");
        b.setAttribute("aria-pressed", "false");
      });
      btn.classList.add("is-active");
      btn.setAttribute("aria-pressed", "true");

      const cat = btn.dataset.cat;
      console.log("[category]", cat);
      // TODO: ãƒ•ã‚£ãƒ«ã‚¿ã‚„é·ç§»ã‚’ã“ã“ã§
      // location.href = `/shops.html?category=${encodeURIComponent(cat)}`;
    };

    strip.addEventListener("click", (e) => {
      const btn = e.target.closest(".cat-item");
      if (btn && strip.contains(btn)) activate(btn);
    });

    if (init) {
      const t = [...strip.querySelectorAll(".cat-item")].find(
        (b) => b.dataset.cat === init
      );
      if (t) activate(t);
    }
  }
  // â–¼ ä¾¡æ ¼å¸¯ãƒãƒƒãƒ—ï¼šå˜ä¸€é¸æŠï¼ˆå†ã‚¯ãƒªãƒƒã‚¯ã§è§£é™¤ï¼‰
  const row = document.querySelector(".chip-row");
  if (row) {
    row.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;

      const isActive = chip.classList.contains("is-active");
      // ã„ã£ãŸã‚“å…¨è§£é™¤
      row.querySelectorAll(".chip").forEach((c) => {
        c.classList.remove("is-active");
        c.setAttribute("aria-pressed", "false");
      });

      let price = null;
      if (!isActive) {
        chip.classList.add("is-active");
        chip.setAttribute("aria-pressed", "true");
        price = chip.dataset.price; // "<=500" ãªã©
      }
      console.log("[price]", price); // TODO: ã“ã“ã§ä¸€è¦§ã®ãƒ•ã‚£ãƒ«ã‚¿ã‚„é·ç§»
      // ä¾‹ï¼‰location.href = `/shops.html?price=${encodeURIComponent(price||'')}`;
    });
  }
</script>
<script type="module">
  import { loadNearby } from "./js/nearby.js?v=20250907";
  import { loadRecent } from "./js/recent.js?v=20250907";

  // --- ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆï¼ˆè¿‘ã„ / å®‰ã„ï¼‰ ---
  let sortMode = localStorage.getItem("sortMode") || "near";
  const seg = document.querySelector(".seg-row");
  if (seg) {
    // åˆæœŸé¸æŠ
    seg.querySelectorAll(".seg-btn").forEach((btn) => {
      const on = btn.dataset.sort === sortMode;
      btn.classList.toggle("is-active", on);
      btn.setAttribute("aria-selected", on ? "true" : "false");
    });
    seg.addEventListener("click", (e) => {
      const btn = e.target.closest(".seg-btn");
      if (!btn) return;
      seg.querySelectorAll(".seg-btn").forEach((b) => {
        b.classList.remove("is-active");
        b.setAttribute("aria-selected", "false");
      });
      btn.classList.add("is-active");
      btn.setAttribute("aria-selected", "true");
      sortMode = btn.dataset.sort || "near";
      localStorage.setItem("sortMode", sortMode);
      // å†èª­è¾¼
      loadNearby(getFilters());
    });
  }

  const getFilters = () => {
    const cat =
      document.querySelector(".cat-item.is-active")?.dataset.cat || null;
    const priceData =
      document.querySelector(".chip.is-active")?.dataset.price || null; // "<=500"
    const priceMax = priceData ? Number(priceData.replace("<=", "")) : null;
    return { category: cat, priceMax, sort: sortMode };
  };

  // åˆæœŸè¡¨ç¤º
  loadNearby(getFilters());
  loadRecent(getFilters());

  // ã‚«ãƒ†ã‚´ãƒª/ä¾¡æ ¼ã®æ—¢å­˜ãƒãƒ³ãƒ‰ãƒ©ã®æœ€å¾Œã«â†“ã‚’æ—¢ã«å…¥ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ãŒã€recentã‚‚è¿½åŠ 
  // ä¾‹ï¼š
  // items.forEach(btn => btn.addEventListener('click', () => { ...; loadNearby(getFilters()); loadRecent(getFilters()); }));
  // row.addEventListener('click', e => { ...; loadNearby(getFilters()); loadRecent(getFilters()); });
</script>
<!-- â˜…â˜…â˜… ãƒ’ãƒ¼ãƒ­ãƒ¼èª­ã¿è¾¼ã¿ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æœ«å°¾ã§èª­ã¿è¾¼ã‚€ â˜…â˜…â˜… -->

<script type="module" src="./js/hero.js"></script>
<script type="module" src="./js/home-hero.js"></script>
<script type="module">
  (() => {
    // äºŒé‡åˆæœŸåŒ–ã‚¬ãƒ¼ãƒ‰
    if (window.__homeCtaRevealInit) return;
    window.__homeCtaRevealInit = true;

    const el = document.querySelector(".home-cta");
    if (!el) return;

    // åˆæœŸã¯éè¡¨ç¤ºï¼ˆCSSã§ opacity:0ï¼‰ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ is-visible ã‚’ä»˜ä¸
    const setVisible = (v) => el.classList.toggle("is-visible", v);

    // ç›£è¦–ç”¨ã®ç›®å°ï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼ã®ç›´å¾Œï¼‰
    const anchor =
      document.querySelector(".hero-spotlight") ||
      document.querySelector(".home-hero") ||
      document.querySelector("main") ||
      document.body;

    const sentinel = document.createElement("div");
    sentinel.id = "cta-reveal-sentinel";
    sentinel.style.cssText = "position:relative;width:1px;height:1px;";
    anchor.after(sentinel);

    if ("IntersectionObserver" in window) {
      // ç›®å°ãŒç”»é¢å†…â†’éè¡¨ç¤º / ç›®å°ãŒä¸Šã«æŠœã‘ãŸâ†’è¡¨ç¤º
      const io = new IntersectionObserver(
        ([entry]) => setVisible(!entry.isIntersecting),
        { root: null, threshold: 0, rootMargin: "0px 0px -60% 0px" }
      );
      io.observe(sentinel);
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const onScroll = () => setVisible(window.scrollY > 80);
      window.addEventListener("scroll", onScroll, { passive: true });
      onScroll();
    }
  })();
</script>
<script type="module">
  (() => {
    if (window.__spotlightAffordanceInit) return;
    window.__spotlightAffordanceInit = true;

    const rail = document.getElementById("spotlight-rail");
    const wrap = rail?.closest(".spotlight-wrap");
    if (!rail || !wrap) return;

    const tiles = [...rail.querySelectorAll(".tile")];
    const dotsEl = document.getElementById("spotlight-dots");
    const cue = document.getElementById("scroll-cue");

    /* ãƒšãƒ¼ã‚¸ãƒ‰ãƒƒãƒˆç”Ÿæˆï¼ˆåˆå›ã®ã¿ï¼‰ */
    if (dotsEl && !dotsEl.children.length) {
      tiles.forEach((_, i) => {
        const li = document.createElement("li");
        li.setAttribute("role", "tab");
        li.setAttribute("aria-label", `ã‚¹ãƒ©ã‚¤ãƒ‰ ${i + 1}`);
        if (i === 0) li.classList.add("is-active");
        dotsEl.appendChild(li);
      });
    }

    /* ã‚¨ãƒƒã‚¸ã‚°ãƒ©ãƒ‡ã®æ›´æ–° */
    const updateEdges = () => {
      const max = rail.scrollWidth - rail.clientWidth - 1;
      wrap.classList.toggle("has-left", rail.scrollLeft > 1);
      wrap.classList.toggle("has-right", rail.scrollLeft < max);
    };
    updateEdges();
    rail.addEventListener(
      "scroll",
      () => {
        updateEdges();
        if (cue) {
          cue.classList.add("is-hidden");
          sessionStorage.setItem("spotlight_cue_seen", "1");
        }
      },
      { passive: true }
    );

    /* ã‚­ãƒ¥ãƒ¼ï¼š1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ä¸€åº¦ã ã‘ */
    if (cue) {
      if (sessionStorage.getItem("spotlight_cue_seen")) {
        cue.classList.add("is-hidden");
      } else {
        rail.addEventListener(
          "pointerdown",
          () => cue.classList.add("is-hidden"),
          { once: true }
        );
      }
    }

    /* å¯è¦–ã‚«ãƒ¼ãƒ‰ã«å¿œã˜ã¦ãƒ‰ãƒƒãƒˆæ›´æ–°ï¼ˆãƒ¬ãƒ¼ãƒ«å†…ç›£è¦–ï¼‰ */
    if ("IntersectionObserver" in window && dotsEl) {
      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((en) => {
            if (en.intersectionRatio >= 0.6) {
              const idx = tiles.indexOf(en.target);
              if (idx >= 0) {
                [...dotsEl.children].forEach((d, i) =>
                  d.classList.toggle("is-active", i === idx)
                );
              }
            }
          });
        },
        { root: rail, threshold: [0.6] }
      );
      tiles.forEach((t) => io.observe(t));
    }
  })();
</script>

<script type="module">
  import { loadNearby } from "./js/nearby.js?v=20250909l";
  import { loadRecent } from "./js/recent.js?v=20250909l";
</script>
