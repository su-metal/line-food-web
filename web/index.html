<!-- HOME:START -->
<header class="app-header">
  <div class="topbar">
    <a class="logo" href="./" aria-label="Mottaina Home">Mottaina</a>
    <button id="btn-locate" type="button" aria-label="ç¾åœ¨åœ°" title="ç¾åœ¨åœ°">ğŸ“</button>
    <a class="cart-link" href="./cart.html" aria-label="ã‚«ãƒ¼ãƒˆ">
      <span class="cart-icon"></span>
      <span id="home-cart-count" class="badge">0</span>
    </a>
  </div>

  <div class="search-row">
    <input id="q" type="search" inputmode="search" autocomplete="off"
           placeholder="åº—åãƒ»å•†å“ãƒ»é§…ã§æ¤œç´¢" aria-label="æ¤œç´¢" />
  </div>

  <nav class="filter-row">
    <!-- ã‚«ãƒ†ã‚´ãƒªï¼ˆæ—¢å­˜æ§‹é€ ã«åˆã‚ã›ã¦å†æ²ï¼‰ -->
    <div class="cat-row" id="category-row">
      <button type="button" class="cat-item is-active" data-cat="">
        <img src="./img/categories/all.png" alt="ã™ã¹ã¦" width="48" height="48" loading="lazy" />
        <span>ã™ã¹ã¦</span>
      </button>
      <button type="button" class="cat-item" data-cat="ãƒ‘ãƒ³">
        <img src="./img/categories/bread.png" alt="ãƒ‘ãƒ³" width="48" height="48" loading="lazy" />
        <span>ãƒ‘ãƒ³</span>
      </button>
      <button type="button" class="cat-item" data-cat="æƒ£èœ">
        <img src="./img/categories/deli.png" alt="æƒ£èœ" width="48" height="48" loading="lazy" />
        <span>æƒ£èœ</span>
      </button>
      <button type="button" class="cat-item" data-cat="ã‚¹ã‚¤ãƒ¼ãƒ„">
        <img src="./img/categories/cake.png" alt="ã‚¹ã‚¤ãƒ¼ãƒ„" width="48" height="48" loading="lazy" />
        <span>ã‚¹ã‚¤ãƒ¼ãƒ„</span>
      </button>
    </div>

    <!-- ä¾¡æ ¼ãƒãƒƒãƒ— + ä¸¦ã³æ›¿ãˆ -->
    <div class="price-sort-row">
      <div class="chip-group" role="group" aria-label="ä¾¡æ ¼ä¸Šé™">
        <button type="button" class="chip is-active" data-price="">ã™ã¹ã¦</button>
        <button type="button" class="chip" data-price="<=300">ã€œÂ¥300</button>
        <button type="button" class="chip" data-price="<=500">ã€œÂ¥500</button>
        <button type="button" class="chip" data-price="<=800">ã€œÂ¥800</button>
      </div>
      <div class="sort-group">
        <label for="sort-mode" class="sr-only">ä¸¦ã³æ›¿ãˆ</label>
        <select id="sort-mode" aria-label="ä¸¦ã³æ›¿ãˆ">
          <option value="near">è¿‘ã„é †</option>
          <option value="cheap">å®‰ã„é †</option>
          <option value="deadline">ç· åˆ‡ãŒæ—©ã„é †</option>
          <option value="popular">äººæ°—é †</option>
        </select>
      </div>
    </div>
  </nav>
</header>

<!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆä»»æ„ã€‚ç”»åƒãŒç„¡ã‘ã‚Œã°å‰Šé™¤å¯ï¼‰ -->
<section id="home-hero" class="hero">
  <img src="./img/hero1.jpg" alt="" width="1280" height="500" loading="eager" />
  <img src="./img/hero2.jpg" alt="" width="1280" height="500" loading="lazy" />
  <img src="./img/hero3.jpg" alt="" width="1280" height="500" loading="lazy" />
</section>

<main class="home-main">
  <section class="section">
    <h3 class="section-title">è¿‘ãã®ãŠã™ã™ã‚</h3>
    <div id="nearby-row" class="card-row hscroll" aria-live="polite"></div>
  </section>

  <section class="section">
    <h3 class="section-title">æœ€è¿‘è¦‹ãŸ</h3>
    <div id="recent-row" class="card-row hscroll" aria-live="polite"></div>
  </section>
</main>

<footer class="app-footer">
  <a id="btn-discover" href="./discover.html" class="button primary">åœ°å›³ã§è¦‹ã‚‹</a>
  <nav class="legal">
    <a href="./help.html">ãƒ˜ãƒ«ãƒ—</a>
    <a href="./terms.html">åˆ©ç”¨è¦ç´„</a>
    <a href="./privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a>
  </nav>
</footer>

<!-- ãƒ›ãƒ¼ãƒ ã§ã¯ã‚«ãƒ¼ãƒˆãƒãƒ¼ã¯éè¡¨ç¤ºã ãŒã€åˆæœŸåŒ–ã®éƒ½åˆã§DOMã¯ç½®ã„ã¦ãŠã -->
<div id="cart-bar" hidden aria-hidden="true"></div>

<!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆç©ºã«ã—ãªã„ï¼ï¼‰ -->
<template id="shop-card-template">
  <article class="shop-card card-v3">
    <div class="card-head"></div>
    <div class="shop-info">
      <h4 class="store-name"></h4>
      <div class="chip-row">
        <span class="chip cat point"></span>
        <span class="chip distance status"></span>
        <span class="chip place"></span>
      </div>
    </div>
    <div class="card-body">
      <!-- JSã§ .product-summary ã‚’å·®ã—è¾¼ã‚€ -->
    </div>
    <button class="fav-btn" type="button" aria-label="ãŠæ°—ã«å…¥ã‚Š"></button>
  </article>
</template>

<!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯1ã¤ã«çµ±åˆï¼ˆæ—§module srcã¯å‰Šé™¤ï¼‰ -->
<script type="module">
  import liff from "https://static.line-scdn.net/liff/edge/2/sdk.js";

  const bust = "v20250910a";

  // å‹•çš„importï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒˆï¼‰
  const [{ loadNearby }, { loadRecent }] = await Promise.all([
    import(`./js/nearby.js?b=${bust}`),
    import(`./js/recent.js?b=${bust}`),
  ]);
  const { initHomeCartCTA } = await import(`./js/cart-cta.js?b=${bust}`);
  // ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚’ä½¿ã†å ´åˆã®ã¿æœ‰åŠ¹åŒ–
  // await import(`./js/hero.js?b=${bust}`);
  // await import(`./js/home-hero.js?b=${bust}`);

  // ãƒ•ã‚£ãƒ«ã‚¿åé›†ï¼ˆæ—¢å­˜JSã¨æ•´åˆï¼‰
  const getFilters = () => {
    const cat = document.querySelector(".cat-item.is-active")?.dataset.cat || null;
    const priceData = document.querySelector(".chip-group .chip.is-active")?.dataset.price || null;
    const priceMax = priceData ? Number(priceData.replace("<=", "")) : null;
    const sort = localStorage.getItem("sortMode") || "near";
    return { category: cat, priceMax, sort };
  };

  // åˆæœŸæç”»
  await Promise.all([loadNearby(getFilters()), loadRecent(getFilters())]);

  // å¤–ã‹ã‚‰å†èª­è¾¼
  window.refreshLists = () => {
    const f = getFilters();
    return Promise.all([loadNearby(f), loadRecent(f)]);
  };

  // ä¾¡æ ¼ãƒãƒƒãƒ—ã®å˜ä¸€é¸æŠ
  document.querySelectorAll(".chip-group .chip").forEach((el) => {
    el.addEventListener("click", () => {
      document.querySelectorAll(".chip-group .chip").forEach(c => c.classList.remove("is-active"));
      el.classList.add("is-active");
      refreshLists();
    });
  });

  // ã‚«ãƒ†ã‚´ãƒªï¼ˆå˜ä¸€é¸æŠã€‚è¤‡æ•°ã«ã—ãŸã„å ´åˆã¯ãƒ­ã‚¸ãƒƒã‚¯æ‹¡å¼µï¼‰
  document.querySelectorAll("#category-row .cat-item").forEach((el) => {
    el.addEventListener("click", () => {
      document.querySelectorAll("#category-row .cat-item").forEach(c => c.classList.remove("is-active"));
      el.classList.add("is-active");
      refreshLists();
    });
  });

  // ä¸¦ã³æ›¿ãˆä¿å­˜ï¼‹åæ˜ 
  const sortSel = document.getElementById("sort-mode");
  sortSel.value = localStorage.getItem("sortMode") || "near";
  sortSel.addEventListener("change", () => {
    localStorage.setItem("sortMode", sortSel.value);
    refreshLists();
  });

  // ã‚«ãƒ¼ãƒˆCTAï¼ˆãƒ›ãƒ¼ãƒ ã¯ãƒãƒƒã‚¸æ›´æ–°ã®ã¿ï¼‰
  initHomeCartCTA({
    buttonSelector: "#cart-bar",
    countSelector: "#home-cart-count",
    totalSelector: "#home-cart-total",
    cartHref: "./cart.html",
  });
</script>
<!-- HOME:END -->
